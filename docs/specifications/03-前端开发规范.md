# 前端开发规范 (Vue 3 + TypeScript)

## 1. 技术栈

### 1.1 核心技术
- **框架**: Vue 3.4+ (Composition API)
- **语言**: TypeScript 5+
- **构建工具**: Vite 5+
- **包管理器**: pnpm 8+
- **状态管理**: Pinia 2+
- **路由**: Vue Router 4+
- **HTTP 客户端**: Axios 1+

### 1.2 UI 组件库
- **推荐**: Element Plus (管理后台)
- **备选**:
  - Ant Design Vue (中后台)
  - Naive UI (轻量级)
  - Vant (移动端)

### 1.3 工具库
- **日期处理**: dayjs
- **工具函数**: lodash-es
- **表单验证**: vee-validate / async-validator
- **图标**: @iconify/vue 或 unplugin-icons
- **CSS 预处理器**: SCSS

---

## 2. 项目初始化

### 2.1 创建项目

```bash
# 使用 create-vue（官方推荐）
pnpm create vue@latest agents-frontend

# 选择配置：
✔ Add TypeScript? … Yes
✔ Add JSX Support? … No
✔ Add Vue Router for Single Page Application development? … Yes
✔ Add Pinia for state management? … Yes
✔ Add Vitest for Unit Testing? … Yes
✔ Add an End-to-End Testing Solution? › No
✔ Add ESLint for code quality? … Yes
✔ Add Prettier for code formatting? … Yes

# 进入项目
cd agents-frontend

# 安装依赖
pnpm install
```

### 2.2 推荐的依赖安装

```bash
# UI 组件库
pnpm add element-plus
pnpm add @element-plus/icons-vue

# HTTP 请求
pnpm add axios

# 工具库
pnpm add dayjs
pnpm add lodash-es
pnpm add @types/lodash-es -D

# CSS 预处理器
pnpm add sass -D

# 自动导入（可选，提高开发效率）
pnpm add unplugin-auto-import unplugin-vue-components -D
```

---

## 3. 目录结构规范

详见 `01-项目结构规范.md` 的前端部分

---

## 4. 编码规范

### 4.1 命名规范

#### 文件命名
```
✅ 组件文件：UserList.vue, ChatDialog.vue (PascalCase)
✅ JS/TS 文件：userApi.ts, useAuth.ts (camelCase)
✅ 样式文件：variables.scss, global.scss (camelCase)
✅ 类型文件：api.d.ts, models.d.ts (camelCase)

❌ 不要用：user-list.vue, UserApi.ts
```

#### 变量命名
```typescript
// 常量：大写下划线
const API_BASE_URL = 'http://localhost:8080';
const MAX_RETRY_COUNT = 3;

// 变量/函数：小驼峰
const userName = 'zhangsan';
const getUserInfo = () => {};

// 类/接口/类型：大驼峰
class UserService {}
interface UserInfo {}
type RequestConfig = {};

// 组件：大驼峰
const UserList = defineComponent({});

// 布尔值：is/has/can 开头
const isLoading = ref(false);
const hasPermission = computed(() => true);
const canEdit = ref(true);

// 事件处理：handle/on 开头
const handleClick = () => {};
const onSubmit = () => {};
```

### 4.2 Vue 3 Composition API 规范

#### 推荐写法：`<script setup>`

```vue
<script setup lang="ts">
import { ref, computed, onMounted } from 'vue';
import { userApi, type User } from '@/api/user';

// Props
interface Props {
  userId: number;
  mode?: 'view' | 'edit';
}
const props = withDefaults(defineProps<Props>(), {
  mode: 'view'
});

// Emits
interface Emits {
  (e: 'update', user: User): void;
  (e: 'delete', id: number): void;
}
const emit = defineEmits<Emits>();

// State
const user = ref<User | null>(null);
const loading = ref(false);

// Computed
const displayName = computed(() => {
  return user.value?.username || 'Unknown';
});

// Methods
const loadUser = async () => {
  loading.value = true;
  try {
    user.value = await userApi.getById(props.userId);
  } catch (error) {
    console.error('Failed to load user', error);
  } finally {
    loading.value = false;
  }
};

const handleUpdate = () => {
  if (user.value) {
    emit('update', user.value);
  }
};

// Lifecycle
onMounted(() => {
  loadUser();
});

// Expose (如果需要父组件访问)
defineExpose({
  loadUser
});
</script>

<template>
  <div class="user-detail">
    <div v-if="loading">Loading...</div>
    <div v-else-if="user">
      <h2>{{ displayName }}</h2>
      <button @click="handleUpdate">Update</button>
    </div>
  </div>
</template>

<style scoped lang="scss">
.user-detail {
  padding: 20px;

  h2 {
    color: #333;
  }
}
</style>
```

#### 组合式函数（Composables）

```typescript
// src/composables/useTable.ts
import { ref, onMounted } from 'vue';

export interface UseTableOptions<T> {
  fetchData: (params: any) => Promise<PageResult<T>>;
  immediate?: boolean;
}

export function useTable<T>(options: UseTableOptions<T>) {
  const { fetchData, immediate = true } = options;

  const list = ref<T[]>([]);
  const total = ref(0);
  const loading = ref(false);
  const pageNum = ref(1);
  const pageSize = ref(10);

  const loadData = async () => {
    loading.value = true;
    try {
      const result = await fetchData({
        pageNum: pageNum.value,
        pageSize: pageSize.value
      });
      list.value = result.list;
      total.value = result.total;
    } catch (error) {
      console.error('Failed to load data', error);
    } finally {
      loading.value = false;
    }
  };

  const handlePageChange = (page: number) => {
    pageNum.value = page;
    loadData();
  };

  const refresh = () => {
    pageNum.value = 1;
    loadData();
  };

  if (immediate) {
    onMounted(() => {
      loadData();
    });
  }

  return {
    list,
    total,
    loading,
    pageNum,
    pageSize,
    loadData,
    handlePageChange,
    refresh
  };
}
```

### 4.3 TypeScript 类型定义

#### API 类型定义
```typescript
// src/types/api.d.ts
declare global {
  // 通用响应
  interface ApiResponse<T = any> {
    code: number;
    message: string;
    data: T;
  }

  // 分页结果
  interface PageResult<T> {
    list: T[];
    total: number;
    pageNum: number;
    pageSize: number;
    pages: number;
  }

  // 分页参数
  interface PageParams {
    pageNum: number;
    pageSize: number;
  }
}

export {};
```

#### 模型类型定义
```typescript
// src/types/models/user.d.ts
export interface User {
  id: number;
  username: string;
  email: string;
  avatar?: string;
  createdAt: string;
  updatedAt: string;
}

export interface CreateUserRequest {
  username: string;
  email: string;
  password: string;
}

export interface UpdateUserRequest {
  username?: string;
  email?: string;
  avatar?: string;
}
```

---

## 5. 组件开发规范

### 5.1 组件分类

#### 公共组件 (components/common/)
- 纯 UI 组件
- 无业务逻辑
- 高复用性
- 通过 props 和 emit 通信

**示例：Button 组件**
```vue
<script setup lang="ts">
interface Props {
  type?: 'primary' | 'success' | 'warning' | 'danger';
  size?: 'small' | 'medium' | 'large';
  loading?: boolean;
  disabled?: boolean;
}

const props = withDefaults(defineProps<Props>(), {
  type: 'primary',
  size: 'medium',
  loading: false,
  disabled: false
});

const emit = defineEmits<{
  (e: 'click', event: MouseEvent): void;
}>();

const handleClick = (event: MouseEvent) => {
  if (!props.loading && !props.disabled) {
    emit('click', event);
  }
};
</script>

<template>
  <button
    :class="['btn', `btn--${type}`, `btn--${size}`]"
    :disabled="disabled || loading"
    @click="handleClick"
  >
    <span v-if="loading" class="btn__loading">Loading...</span>
    <slot v-else />
  </button>
</template>
```

#### 业务组件 (components/business/)
- 包含业务逻辑
- 调用 API
- 可能依赖 store

**示例：UserSelector 组件**
```vue
<script setup lang="ts">
import { ref, onMounted } from 'vue';
import { userApi, type User } from '@/api/user';

interface Props {
  modelValue?: number; // 选中的用户 ID
}

const props = defineProps<Props>();

const emit = defineEmits<{
  (e: 'update:modelValue', value: number): void;
  (e: 'change', user: User): void;
}>();

const users = ref<User[]>([]);
const loading = ref(false);

const loadUsers = async () => {
  loading.value = true;
  try {
    const result = await userApi.list({ pageNum: 1, pageSize: 100 });
    users.value = result.list;
  } finally {
    loading.value = false;
  }
};

const handleChange = (userId: number) => {
  const user = users.value.find(u => u.id === userId);
  if (user) {
    emit('update:modelValue', userId);
    emit('change', user);
  }
};

onMounted(() => {
  loadUsers();
});
</script>

<template>
  <el-select
    :model-value="modelValue"
    :loading="loading"
    @update:model-value="handleChange"
  >
    <el-option
      v-for="user in users"
      :key="user.id"
      :label="user.username"
      :value="user.id"
    />
  </el-select>
</template>
```

#### 页面组件 (views/)
- 路由对应的页面
- 组合多个组件
- 处理页面级状态

### 5.2 组件通信

#### Props（父 → 子）
```vue
<!-- 父组件 -->
<UserDetail :user-id="123" mode="edit" />

<!-- 子组件 -->
<script setup lang="ts">
interface Props {
  userId: number;
  mode: 'view' | 'edit';
}
const props = defineProps<Props>();
</script>
```

#### Emit（子 → 父）
```vue
<!-- 子组件 -->
<script setup lang="ts">
const emit = defineEmits<{
  (e: 'save', data: User): void;
  (e: 'cancel'): void;
}>();

const handleSave = () => {
  emit('save', userData);
};
</script>

<!-- 父组件 -->
<UserForm @save="handleSave" @cancel="handleCancel" />
```

#### v-model（双向绑定）
```vue
<!-- 子组件 -->
<script setup lang="ts">
interface Props {
  modelValue: string;
}
const props = defineProps<Props>();

const emit = defineEmits<{
  (e: 'update:modelValue', value: string): void;
}>();
</script>

<!-- 父组件 -->
<CustomInput v-model="inputValue" />
```

#### Provide/Inject（跨层级通信）
```vue
<!-- 祖先组件 -->
<script setup lang="ts">
import { provide } from 'vue';

const theme = ref('light');
provide('theme', theme);
</script>

<!-- 后代组件 -->
<script setup lang="ts">
import { inject } from 'vue';

const theme = inject<Ref<string>>('theme');
</script>
```

---

## 6. 状态管理 (Pinia)

### 6.1 Store 定义

```typescript
// src/stores/auth.ts
import { defineStore } from 'pinia';
import { ref, computed } from 'vue';
import type { User } from '@/types/models/user';
import { authApi } from '@/api/auth';

export const useAuthStore = defineStore('auth', () => {
  // State
  const token = ref<string | null>(localStorage.getItem('token'));
  const user = ref<User | null>(null);
  const isLoggedIn = computed(() => !!token.value);

  // Actions
  const login = async (username: string, password: string) => {
    const result = await authApi.login({ username, password });
    token.value = result.token;
    user.value = result.user;
    localStorage.setItem('token', result.token);
  };

  const logout = () => {
    token.value = null;
    user.value = null;
    localStorage.removeItem('token');
  };

  const fetchUserInfo = async () => {
    if (!token.value) return;
    user.value = await authApi.getUserInfo();
  };

  return {
    // State
    token,
    user,
    isLoggedIn,

    // Actions
    login,
    logout,
    fetchUserInfo
  };
});
```

### 6.2 在组件中使用

```vue
<script setup lang="ts">
import { useAuthStore } from '@/stores/auth';

const authStore = useAuthStore();

const handleLogin = async () => {
  await authStore.login('username', 'password');
  router.push('/dashboard');
};

const handleLogout = () => {
  authStore.logout();
  router.push('/login');
};
</script>

<template>
  <div v-if="authStore.isLoggedIn">
    <p>Welcome, {{ authStore.user?.username }}</p>
    <button @click="handleLogout">Logout</button>
  </div>
  <div v-else>
    <button @click="handleLogin">Login</button>
  </div>
</template>
```

---

## 7. 路由管理

### 7.1 路由配置

```typescript
// src/router/routes.ts
import type { RouteRecordRaw } from 'vue-router';

export const routes: RouteRecordRaw[] = [
  {
    path: '/login',
    name: 'Login',
    component: () => import('@/views/auth/Login.vue'),
    meta: {
      title: '登录',
      requiresAuth: false
    }
  },
  {
    path: '/',
    component: () => import('@/layouts/DefaultLayout.vue'),
    redirect: '/dashboard',
    meta: {
      requiresAuth: true
    },
    children: [
      {
        path: 'dashboard',
        name: 'Dashboard',
        component: () => import('@/views/dashboard/Index.vue'),
        meta: {
          title: '仪表盘',
          icon: 'dashboard'
        }
      },
      {
        path: 'users',
        name: 'UserList',
        component: () => import('@/views/user/List.vue'),
        meta: {
          title: '用户管理',
          icon: 'user',
          permissions: ['user:view']
        }
      }
    ]
  }
];
```

### 7.2 路由守卫

```typescript
// src/router/guards.ts
import type { Router } from 'vue-router';
import { useAuthStore } from '@/stores/auth';

export function setupRouterGuards(router: Router) {
  // 全局前置守卫
  router.beforeEach(async (to, from, next) => {
    const authStore = useAuthStore();

    // 设置页面标题
    document.title = to.meta.title as string || 'App';

    // 检查是否需要登录
    if (to.meta.requiresAuth && !authStore.isLoggedIn) {
      next({ name: 'Login', query: { redirect: to.fullPath } });
      return;
    }

    // 检查权限
    const permissions = to.meta.permissions as string[];
    if (permissions && permissions.length > 0) {
      const hasPermission = permissions.every(p =>
        authStore.user?.permissions?.includes(p)
      );
      if (!hasPermission) {
        next({ name: 'Forbidden' });
        return;
      }
    }

    next();
  });

  // 全局后置守卫
  router.afterEach(() => {
    // 可以在这里关闭 loading
  });
}
```

---

## 8. HTTP 请求规范

详见 `02-API接口规范.md` 的前端部分

---

## 9. 样式规范

### 9.1 CSS 命名（BEM）

```scss
// Block__Element--Modifier
.user-card {
  // Block
  padding: 20px;

  &__avatar {
    // Element
    width: 50px;
    height: 50px;
  }

  &__name {
    font-size: 16px;
  }

  &--featured {
    // Modifier
    border: 2px solid gold;
  }
}
```

### 9.2 SCSS 变量

```scss
// src/assets/styles/variables.scss
// 颜色
$primary-color: #409eff;
$success-color: #67c23a;
$warning-color: #e6a23c;
$danger-color: #f56c6c;

$text-color-primary: #303133;
$text-color-regular: #606266;
$text-color-secondary: #909399;

// 间距
$spacing-xs: 4px;
$spacing-sm: 8px;
$spacing-md: 16px;
$spacing-lg: 24px;
$spacing-xl: 32px;

// 圆角
$border-radius-sm: 2px;
$border-radius-md: 4px;
$border-radius-lg: 8px;

// 阴影
$box-shadow-light: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
$box-shadow-base: 0 2px 4px rgba(0, 0, 0, 0.12), 0 0 6px rgba(0, 0, 0, 0.04);
```

### 9.3 Scoped 样式

```vue
<style scoped lang="scss">
// scoped 样式只影响当前组件
.user-list {
  padding: 20px;
}

// 深度选择器（影响子组件）
:deep(.el-table) {
  font-size: 14px;
}

// 全局选择器
:global(.global-class) {
  color: red;
}
</style>
```

---

## 10. 性能优化

### 10.1 组件懒加载

```typescript
// 路由懒加载
const UserList = () => import('@/views/user/List.vue');

// 组件懒加载
const HeavyComponent = defineAsyncComponent(() =>
  import('@/components/HeavyComponent.vue')
);
```

### 10.2 列表优化

```vue
<script setup lang="ts">
import { ref } from 'vue';

const list = ref([...]); // 大量数据

// 使用虚拟滚动（如 vue-virtual-scroller）
</script>

<template>
  <!-- 使用 key 优化 v-for -->
  <div v-for="item in list" :key="item.id">
    {{ item.name }}
  </div>
</template>
```

### 10.3 计算属性缓存

```vue
<script setup lang="ts">
import { computed } from 'vue';

const users = ref([...]);

// 使用 computed 而不是 method
const activeUsers = computed(() => {
  return users.value.filter(u => u.active);
});
</script>
```

### 10.4 防抖与节流

```typescript
// src/utils/debounce.ts
import { ref } from 'vue';
import { debounce } from 'lodash-es';

export function useDebouncedSearch() {
  const keyword = ref('');
  const results = ref([]);

  const search = debounce(async (value: string) => {
    results.value = await api.search(value);
  }, 300);

  return { keyword, results, search };
}
```

---

## 11. 测试规范

### 11.1 单元测试

```typescript
// UserList.spec.ts
import { describe, it, expect } from 'vitest';
import { mount } from '@vue/test-utils';
import UserList from '@/views/user/List.vue';

describe('UserList', () => {
  it('renders user list', () => {
    const wrapper = mount(UserList);
    expect(wrapper.find('.user-list').exists()).toBe(true);
  });

  it('loads users on mount', async () => {
    const wrapper = mount(UserList);
    await wrapper.vm.$nextTick();
    expect(wrapper.vm.users.length).toBeGreaterThan(0);
  });
});
```

---

## 12. 构建与部署

### 12.1 环境变量

```ini
# .env.development
VITE_APP_TITLE=开发环境
VITE_API_BASE_URL=http://localhost:8080/api

# .env.production
VITE_APP_TITLE=生产环境
VITE_API_BASE_URL=https://api.example.com
```

### 12.2 构建命令

```bash
# 开发
pnpm dev

# 构建
pnpm build

# 预览构建结果
pnpm preview

# 类型检查
pnpm type-check

# Lint
pnpm lint
```

---

## 13. 最佳实践

### ✅ DO
- 使用 Composition API
- 使用 TypeScript
- 组件职责单一
- Props 使用类型定义
- 合理使用 computed
- 及时清理副作用（如定时器）
- 使用 ESLint 和 Prettier

### ❌ DON'T
- 不要在模板中写复杂逻辑
- 不要直接修改 props
- 不要滥用 watch
- 不要在循环中使用 index 作为 key
- 不要在 computed 中修改响应式数据
- 不要忽略 TypeScript 错误

---

> **版本**: v1.0
> **更新日期**: 2026-02-05
> **维护者**: AI Assistant
