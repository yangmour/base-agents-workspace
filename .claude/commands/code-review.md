---
description: 对指定的代码文件或目录进行全面的代码审计，检查安全漏洞、性能问题、代码规范和最佳实践
---

# 代码审计

请对指定的代码进行全面审计，重点检查以下方面：

## 1. 安全性审计

### 后端安全（针对 Java Spring Boot）
- **SQL 注入**：检查 MyBatis-Plus 查询是否使用参数化查询，避免字符串拼接
- **XSS 攻击**：检查是否对用户输入进行适当的转义和验证
- **认证授权**：
  - Token 验证是否正确实现
  - 接口权限控制是否完整（@PreAuthorize 等注解）
  - 是否正确使用业务线隔离
- **敏感数据**：
  - 密码、Token 等敏感信息是否加密存储
  - 日志中是否泄露敏感信息
  - 响应中是否暴露过多内部信息
- **输入验证**：Controller 层是否使用 @Valid 或 @Validated 进行参数校验
- **文件上传**：是否限制文件类型、大小，是否验证文件内容
- **CORS 配置**：跨域配置是否安全合理

### 前端安全（针对 Vue 3 + TypeScript）
- **XSS 防护**：是否使用 v-html 注入未过滤的 HTML
- **敏感数据**：localStorage/sessionStorage 中是否存储明文密码等敏感信息
- **API 调用**：是否正确处理 Token 过期和权限不足的情况

## 2. 代码质量审计

### 后端代码质量
- **响应格式**：是否统一使用 `RI<T>` 封装响应
- **异常处理**：
  - 业务异常是否使用 BizException
  - 是否有未捕获的异常
  - 异常信息是否清晰
- **事务管理**：
  - @Transactional 注解是否正确使用
  - 事务边界是否合理
  - 是否存在事务失效问题（如方法内部调用）
- **资源管理**：是否正确关闭数据库连接、文件流等资源
- **空指针检查**：是否存在潜在的 NPE 风险
- **代码重复**：是否存在大量重复代码，是否应该提取公共方法

### 前端代码质量
- **类型安全**：
  - TypeScript 类型定义是否完整
  - 是否滥用 any 类型
  - API 响应类型是否与后端 DTO 匹配
- **响应式数据**：Pinia store 使用是否正确
- **组件设计**：组件职责是否单一，是否过度耦合

## 3. 性能问题审计

### 后端性能
- **数据库查询**：
  - 是否存在 N+1 查询问题
  - 查询是否使用了合适的索引
  - 是否有全表扫描
  - 分页查询是否正确实现
- **缓存使用**：
  - 是否合理使用 Redis 缓存
  - 缓存过期策略是否合理
  - 是否存在缓存穿透、击穿、雪崩风险
- **批量操作**：循环中是否存在数据库操作，是否应该使用批量操作
- **资源占用**：是否存在内存泄漏、连接泄漏风险

### 前端性能
- **请求优化**：是否存在不必要的重复请求
- **列表渲染**：大列表是否使用虚拟滚动
- **组件加载**：是否使用懒加载和代码分割

## 4. 代码规范审计

### 项目规范遵循
- **命名规范**：
  - 类名、方法名、变量名是否符合规范
  - 数据库表名、字段名是否符合规范
- **响应格式**：是否遵循 RI<T> 响应格式（code: 200/600/500）
- **分页规范**：是否使用 PageResult<T>（pageNum, pageSize, total, list）
- **包结构**：controller/service/mapper 层次是否清晰
- **公共模块**：是否正确使用 base-basic/base-redis 等公共模块

### 前后端契约
- **接口一致性**：
  - 后端 DTO/VO 与前端 TypeScript 类型是否匹配
  - 字段映射是否正确（msg vs message, data vs data）
  - 前端 types/api.d.ts 是否与后端接口同步
- **API 文档**：Knife4j 注解是否完整

## 5. 最佳实践审计

### 微服务最佳实践
- **服务划分**：服务职责是否单一
- **Feign 调用**：是否正确使用 Feign 客户端，是否有降级处理
- **配置管理**：是否正确使用 Nacos 配置中心
- **日志规范**：日志级别是否合理，是否包含 traceId

### WebFlux vs MVC
- **模块依赖**：WebFlux 服务是否错误依赖了 base-knife4j（应该用 base-knife4j-webflux）
- **响应式编程**：WebFlux 服务是否正确使用响应式 API

## 审计输出要求

请按以下格式输出审计结果：

### ✅ 优点
列出代码中做得好的地方

### ⚠️ 发现的问题
按严重程度分类：
- **严重问题**（🔴 必须修复）：安全漏洞、数据丢失风险等
- **重要问题**（🟡 建议修复）：性能问题、代码质量问题
- **建议优化**（🔵 可选）：代码规范、最佳实践建议

每个问题包含：
1. 问题描述
2. 问题位置（文件名:行号）
3. 风险说明
4. 修复建议（提供具体代码示例）

### 📊 审计总结
- 总体评分（1-10）
- 主要风险点
- 优先修复项

---

**使用方法**：
```
/code-review path/to/file.java
/code-review path/to/directory
/code-review  # 审计当前变更的文件
```
